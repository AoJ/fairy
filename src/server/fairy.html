<!DOCTYPE HTML>
<html>
<head>
<meta charset="utf-8">
<link href="http://twitter.github.com/bootstrap/assets/css/bootstrap.css" rel="stylesheet">
<link href="fairy.css" rel="stylesheet">
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js" type="text/javascript"></script>
<script src="http://twitter.github.com/bootstrap/assets/js/bootstrap.js" type="text/javascript"></script>
<script src="http://documentcloud.github.com/underscore/underscore-min.js" type="text/javascript"></script>
<script src="https://raw.github.com/timrwood/moment/1.6.2/moment.js" type="text/javascript"></script>
<title>Fairy Statistics</title>

</head>

<body>
<!--Grid start-->
<div class="container">
<h1><span>Fairy Statistics</span></h1>

<div class="table_title">Overview</div>
<div id="statistics"></div>
<div id="queque_detail">

  <div class="table_title">Glance<i class="icon-th"></i><i class="icon-th-large active"></i></div>
  <div id="statistic"></div>
  
  <div class="table_title">WOrkers</div>
  <div id="workers"></div>
  
  <!--最近处理任务---失败任务汇总---周期最长-->
  <div class="tabbable">
    <ul class="nav nav-tabs">
      <li class="active"><a href="#tab1" data-toggle="tab">最近处理任务</a></li>
      <li><a href="#tab2" data-toggle="tab">失败任务汇总</a></li>
      <li><a href="#tab3" data-toggle="tab">周期最长</a></li>
    </ul>
    <div class="tab-content">
	  
      <div class="tab-pane-title">最近处理任务</div>
      <div class="tab-pane active" id="tab1">
        <div id="recently_finished_tasks"></div>
      </div>
    
      <div class="tab-pane-title">失败任务汇总</div>
      <div class="tab-pane" id="tab2">
        <div id="failed_tasks"></div>
      </div>
    
      <div class="tab-pane-title">周期最长</div>
      <div class="tab-pane" id="tab3">
        <div id="slowest_tasks"></div>
      </div>
    
    </div>
  </div>
  
  
  
</div>



<!--template-->
<script id="tb_statistic_template" type = "template/underscore" >
  <table class="table table-bordered">
    <tr><td>Toalt</td><td><%= statistic.finished_tasks %></td></tr>
    <tr><td>Avg. Waiting In</td><td><%= statistic.average_pending_time %></td></tr>
    <tr><td>Avg. Processing In</td><td><%= statistic.average_processing_time %></td></tr>
    <tr><td>Avg. Finished In</td><td><%= Number(statistic.average_pending_time) + Number(statistic.average_processing_time) %></td></tr>
  </table>
</script>


<script id="tb_recently_finished_tasks_template" type = "template/underscore" >
  <table class="table table-bordered">
   <thead>
     <tr>
      <th> 编号</th>
      <th colspan = <%= finished_tasks.length?(finished_tasks[0].length -3):0 %>> 参数</th>
      <th> 进入堆栈时间</th>
      <th> 完成时间</th>
     </tr>
   </thead>
   <tbody>
     <% _.each(finished_tasks, function(item) { %>
     <tr>
      <td><%= _.first(item).substring(0,8) %></td>
      <%_.each(_.first(_.rest(item,1),item.length-3), function(value){ %>
      <td> <%= value %> </td>     
      <% })%>
      <td> <%= moment.duration((new Date).valueOf()-_.last(item,2)[0]).humanize()%></td>
      <td> <%= moment.duration((new Date).valueOf()-_.last(item,2)[1]).humanize()%></td>
     </tr>
     <% }) %>
   </tbody>
  </table>
</script>


<script id="tb_failed_template" type = "template/underscore" >
  <table class="table table-bordered">
   <thead>
     <tr>
      <th> 编号</th>
      <th colspan = <%= failed_tasks.length?(failed_tasks[0].length -4):0 %>> 参数</th>
      <th> 进入堆栈时间</th>
      <th> 完成时间</th>
      <th> 失败原因</th>
     </tr>
   </thead>
   <tbody>
   <% _.each(failed_tasks, function(item) { %>
   <tr>
    <td><%= _.first(item).substring(0,8) %></td>
    <%_.each(_.first(_.rest(item,1),item.length-4), function(value){ %>
    <td> <%= value %> </td>     
    <% })%>
    <td> <%= moment.duration((new Date).valueOf()-_.last(item,3)[0]).humanize()%></td>
    <td> <%= moment.duration((new Date).valueOf()-_.last(item,3)[1]).humanize()%></td>
    <td> <%= _.last(item,3)[2] %></td>
   </tr>
   <% }) %>
   </tbody>
  </table>
</script>

<script id="tb_slowest_template" type = "template/underscore" >
  <table class="table table-bordered">
   <thead>
     <tr>
      <th> 编号</th>
      <th colspan = <%= slowest_tasks.length?(slowest_tasks[0].length -3):0 %>> 参数</th>
      <th> 进入堆栈时间</th>
      <th> 完成时间</th>
     </tr>
   </thead>
   <% _.each(slowest_tasks, function(item) { %>
   <tbody>
     <tr>
      <td><%= _.first(item).substring(0,8) %></td>
      <%_.each(_.first(_.rest(item,1),item.length-3), function(value){ %>
      <td> <%= value %> </td>     
      <% })%>
      <td> <%= moment.duration((new Date).valueOf()-_.last(item,2)[0]).humanize()%></td>
      <td> <%= parse_milliseconds(_.last(item))%></td>
     </tr>
     <% }) %>
   </tbody>
  </table>
</script>


<script id="tb_workers_template" type = "template/underscore" >
  <table class="table table-bordered">
   <thead>
   <tr>
    <td>Host Name</td>
    <td>IP</td>
    <td>Process ID</td>
    <td>start</td>
   </tr>
   </thead>
   <tbody>
     <% _.each(workers, function(item) { %>
     <tr>
      <td><%= item.host %></td>
      <td><%= item.ip %></td>
      <td><%= item.pid %></td>
      <td> uptime </td>
     </tr>
     <% }) %>
   </tbody>
  </table>
</script>


<script src="fairy_active.js" type="text/javascript"></script>
<script src="http://twitter.github.com/bootstrap/assets/js/bootstrap.js" type="text/javascript"></script>
</body>
</html>
