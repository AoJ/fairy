<!DOCTYPE html> <html> <head> <title>fairy » src › web › fairy.coffee</title> <meta http-equiv="content-type" content="text/html; charset=UTF-8"> <meta name="generator" content="Docco"> <link rel="stylesheet" media="all" href="../../stylesheets/docco.css" />   </head> <body> <div id="container"> <div id="background"></div> <table cellpadding="0" cellspacing="0"> <thead><tr><th class="docs"><h1>fairy.coffee</h1></th><th class="code"></th></tr></thead> <tbody>   <tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre></pre></div></td></tr>   <tr id="section-2"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-2">&#182;</a></div><p>统计列表的模板数组</p></td><td class="code"><div class="highlight"><pre><span class="nv">statistics_template = </span><span class="p">[</span>
  <span class="s">&#39;&lt;table class=&quot;table table-bordered overview&quot;&gt;&#39;</span><span class="p">,</span>
  <span class="s">&#39;&lt;thead&gt;&lt;tr&gt;&lt;th&gt;Queue&lt;/th&gt;&lt;th&gt;Workers&lt;/th&gt;&lt;th&gt;Avg. Time&lt;/th&gt;&lt;th&gt;Total&lt;/th&gt;&lt;th&gt;Finished&lt;/th&gt;&lt;th&gt;Processing&lt;/th&gt;&lt;th&gt;Pending&lt;/th&gt;&lt;th&gt;Failed&lt;/th&gt;&lt;th&gt;Blocked&lt;/th&gt;&lt;th&gt;Schedule&lt;/th&gt;&lt;th&gt;Clear&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&#39;</span><span class="p">,</span>
  <span class="s">&#39;&lt;tbody&gt;&#39;</span><span class="p">,</span>
  <span class="s">&#39;&lt;% _.each(data, function(item){ %&gt;&#39;</span><span class="p">,</span>
  <span class="s">&#39;&lt;tr&gt;&#39;</span><span class="p">,</span>
  <span class="s">&#39;&lt;td&gt;&lt;%= item.name %&gt;&lt;/td&gt;&lt;td&gt;&lt;%= item.workers%&gt;&lt;/td&gt;&lt;td&gt;&lt;%= item.average_pending_time + item.average_process_time%&gt;&lt;/td&gt;&lt;td&gt;&lt;span&gt;&lt;%= item.total.tasks%&gt;&lt;/span&gt;&lt;span&gt;/&lt;/span&gt;&lt;span&gt;&lt;%= item.total.groups%&gt;&lt;span&gt;&lt;/td&gt;&lt;td&gt;&lt;%= item.finished_tasks%&gt;&lt;/td&gt;&lt;td&gt;&lt;%= item.processing_tasks%&gt;&lt;/td&gt;&lt;td&gt;&lt;%= item.pending_tasks%&gt;&lt;/td&gt;&lt;td&gt;&lt;%= item.failed_tasks%&gt;&lt;/td&gt;&lt;td&gt;&lt;span&gt;&lt;%= item.blocked.tasks%&gt;&lt;/span&gt;&lt;span&gt;/&lt;/span&gt;&lt;span&gt;&lt;%= item.blocked.groups%&gt;&lt;span&gt;&lt;/td&gt;&lt;td&gt;&lt;button class=&quot;btn_reschedule&quot;&gt;Schedule&lt;/button&gt;&lt;/td&gt;&lt;td&gt;&lt;button class=&quot;btn_clear&quot;&gt;Clear&lt;/button&gt;&lt;/td&gt;&#39;</span><span class="p">,</span>
  <span class="s">&#39;&lt;/tr&gt;&#39;</span><span class="p">,</span>
  <span class="s">&#39;&lt;%})%&gt;&#39;</span><span class="p">,</span>
  <span class="s">&#39;&lt;/tbody&gt;&#39;</span><span class="p">,</span>
  <span class="s">&#39;&lt;tfoot&gt;&#39;</span><span class="p">,</span>
  <span class="s">&#39;&lt;tr&gt;&#39;</span><span class="p">,</span>
  <span class="s">&#39;&lt;td&gt;Total&lt;/td&gt;&lt;td&gt;&lt;%= _.reduce(data, function(memo, item){ return memo + Number(item.workers); }, 0)%&gt;&lt;/td&gt;&lt;td&gt;-&lt;/td&gt;&lt;td&gt;&lt;span&gt;&lt;%= _.reduce(data, function(memo, item){ return memo + Number(item.total.tasks); }, 0)%&gt;&lt;/span&gt;&lt;span&gt;/&lt;/span&gt;&lt;span&gt;&lt;%= _.reduce(data, function(memo, item){ return memo + Number(item.total.groups); }, 0) %&gt;&lt;/span&gt;&lt;/td&gt;&lt;td&gt;&lt;%= _.reduce(data, function(memo, item){ return memo + Number(item.finished_tasks); }, 0)%&gt;&lt;/td&gt;&lt;td&gt;&lt;%= _.reduce(data, function(memo, item){ return memo + Number(item.processing_tasks); }, 0)%&gt;&lt;/td&gt;&lt;td&gt;&lt;%= _.reduce(data, function(memo, item){ return memo + Number(item.pending_tasks); }, 0)%&gt;&lt;/td&gt;&lt;td&gt;&lt;%= _.reduce(data, function(memo, item){ return memo + Number(item.failed_tasks); }, 0)%&gt;&lt;/td&gt;&lt;td&gt;&lt;span&gt;&lt;%= _.reduce(data, function(memo, item){ return memo + Number(item.blocked.tasks); }, 0)%&gt;&lt;/span&gt;&lt;span&gt;/&lt;/span&gt;&lt;span&gt;&lt;%= _.reduce(data, function(memo, item){ return memo + Number(item.blocked.groups); }, 0)%&gt;&lt;/span&gt;&lt;/td&gt;&lt;td&gt;&amp;nbsp;&lt;/td&gt;&lt;td&gt;&amp;nbsp;&lt;/td&gt;&#39;</span><span class="p">,</span>
  <span class="s">&#39;&lt;/tr&gt;&#39;</span><span class="p">,</span>
  <span class="s">&#39;&lt;/tfoot&gt;&#39;</span><span class="p">,</span>
  <span class="s">&#39;&lt;/table&gt;&#39;</span>
<span class="p">]</span></pre></div></td></tr>   <tr id="section-3"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-3">&#182;</a></div><p>用以当队列信息发生变化，更新统计列表的total行</p></td><td class="code"><div class="highlight"><pre><span class="nv">statistics = </span><span class="p">[]</span></pre></div></td></tr>   <tr id="section-4"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-4">&#182;</a></div><p>下拉列表选中索引</p></td><td class="code"><div class="highlight"><pre><span class="nv">select_index = </span><span class="mi">0</span></pre></div></td></tr>   <tr id="section-5"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-5">&#182;</a></div><p>刷新时间间隔</p></td><td class="code"><div class="highlight"><pre><span class="nv">interval = </span><span class="nx">$</span><span class="p">(</span><span class="s">&quot;select option:selected&quot;</span><span class="p">).</span><span class="nx">val</span><span class="p">()</span></pre></div></td></tr>   <tr id="section-6"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-6">&#182;</a></div><p>页面加载事件</p></td><td class="code"><div class="highlight"><pre><span class="nx">$</span> <span class="o">-&gt;</span>
  <span class="nx">$</span><span class="p">(</span><span class="s">&#39;select&#39;</span><span class="p">).</span><span class="nx">find</span><span class="p">(</span><span class="s">&quot;option:nth-child(1)&quot;</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s">&quot;selected&quot;</span><span class="p">,</span><span class="s">&quot;true&quot;</span><span class="p">)</span>
  <span class="nx">render_master</span><span class="p">()</span>
  <span class="nx">events_bind</span><span class="p">()</span></pre></div></td></tr>   <tr id="section-7"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-7">&#182;</a></div><p>渲染队列统计列表信息</p></td><td class="code"><div class="highlight"><pre><span class="nv">render_master = </span><span class="nf">() -&gt;</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="p">(</span><span class="k">new</span> <span class="nb">Date</span><span class="p">).</span><span class="nx">toString</span><span class="p">()</span>
  <span class="nx">$</span><span class="p">(</span><span class="s">&#39;button&#39;</span><span class="p">).</span><span class="nx">die</span><span class="p">(</span><span class="s">&quot;click&quot;</span><span class="p">)</span>
  <span class="nx">$</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s">&#39;/api/queues/statistics&#39;</span><span class="p">,</span> <span class="nf">(data) -&gt;</span>
    <span class="nx">$</span><span class="p">(</span><span class="s">&#39;#m_statistics&#39;</span><span class="p">).</span><span class="nx">html</span> <span class="nx">_</span><span class="p">.</span><span class="nx">template</span><span class="p">(</span><span class="nx">statistics_template</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">),</span> <span class="p">{</span> <span class="nv">data : </span><span class="nx">data</span><span class="p">})</span>
    <span class="k">if</span> <span class="nx">$</span><span class="p">(</span><span class="s">&#39;#queque_detail&#39;</span><span class="p">).</span><span class="o">is</span><span class="p">(</span><span class="s">&quot;:visible&quot;</span><span class="p">)</span>
      <span class="nx">$</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="s">&#39;#m_statistics tbody tr&#39;</span><span class="p">)[</span><span class="nx">select_index</span><span class="p">]).</span><span class="nx">attr</span><span class="p">(</span><span class="s">&quot;class&quot;</span><span class="p">,</span><span class="s">&quot;active&quot;</span><span class="p">)</span>
      <span class="nv">name = </span><span class="nx">$</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="s">&#39;#m_statistics tbody tr&#39;</span><span class="p">)[</span><span class="nx">select_index</span><span class="p">]).</span><span class="nx">find</span><span class="p">(</span><span class="s">&#39;td:first&#39;</span><span class="p">)).</span><span class="nx">html</span><span class="p">()</span>
      <span class="nx">render_slave</span> <span class="nx">name</span>
    <span class="nx">setTimeout</span> <span class="nx">render_master</span><span class="p">,</span> <span class="nx">interval</span><span class="o">*</span><span class="mi">1000</span>
  <span class="p">)</span></pre></div></td></tr>   <tr id="section-8"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-8">&#182;</a></div><p>对指定队列的所有相关明细（统计信息、最近处理任务、失败任务汇总、用时最长任务、处理中任务、工人）数据的渲染</p></td><td class="code"><div class="highlight"><pre><span class="nv">render_slave = </span><span class="nf">(name) -&gt;</span>
  <span class="nv">commands = </span><span class="p">[</span>
    <span class="s">&#39;statistics&#39;</span>
    <span class="s">&#39;recently_finished_tasks&#39;</span>
    <span class="s">&#39;failed_tasks&#39;</span>
    <span class="s">&#39;slowest_tasks&#39;</span>
    <span class="s">&#39;processing_tasks&#39;</span>
    <span class="s">&#39;workers&#39;</span>
  <span class="p">]</span>
  <span class="k">for</span> <span class="nx">command</span> <span class="k">in</span> <span class="nx">commands</span>
    <span class="nx">do</span> <span class="nf">(command) -&gt;</span>
      <span class="nx">$</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s">&#39;/api/queues/&#39;</span> <span class="o">+</span> <span class="nx">name</span> <span class="o">+</span> <span class="s">&quot;/</span><span class="si">#{</span><span class="nx">command</span><span class="si">}</span><span class="s">&quot;</span><span class="p">,</span> <span class="nf">(results) -&gt;</span>
        <span class="nv">param = </span><span class="p">{}</span>
        <span class="nx">param</span><span class="p">[</span><span class="nx">command</span><span class="p">]</span> <span class="o">=</span> <span class="nx">results</span>
        <span class="nx">$</span><span class="p">(</span><span class="s">&quot;</span><span class="err">#</span><span class="s">s_</span><span class="si">#{</span><span class="nx">command</span><span class="si">}</span><span class="s">&quot;</span><span class="p">).</span><span class="nx">html</span> <span class="nx">_</span><span class="p">.</span><span class="nx">template</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="s">&quot;</span><span class="err">#</span><span class="s">tb_</span><span class="si">#{</span><span class="nx">command</span><span class="si">}</span><span class="s">_template&quot;</span><span class="p">).</span><span class="nx">html</span><span class="p">(),</span> <span class="nx">param</span><span class="p">)</span>
        <span class="k">if</span> <span class="nx">command</span> <span class="o">is</span> <span class="s">&#39;failed_tasks&#39;</span>
          <span class="nx">$</span><span class="p">(</span><span class="s">&quot;.failed_popover&quot;</span><span class="p">).</span><span class="nx">find</span><span class="p">(</span><span class="s">&quot;.nav-tabs&gt;li:first&quot;</span><span class="p">).</span><span class="nx">addClass</span><span class="p">(</span><span class="s">&quot;active&quot;</span><span class="p">)</span>
          <span class="nx">$</span><span class="p">(</span><span class="s">&quot;.failed_popover&quot;</span><span class="p">).</span><span class="nx">find</span><span class="p">(</span><span class="s">&quot;.tab-content&gt;div:first&quot;</span><span class="p">).</span><span class="nx">addClass</span><span class="p">(</span><span class="s">&quot;active&quot;</span><span class="p">)</span>
      <span class="p">)</span></pre></div></td></tr>   <tr id="section-9"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-9">&#182;</a></div><p>注册reschedule和clear事件</p></td><td class="code"><div class="highlight"><pre><span class="nv">events_bind = </span><span class="nf">() -&gt;</span>
  <span class="nx">$</span><span class="p">(</span><span class="s">&#39;#m_statistics&#39;</span><span class="p">).</span><span class="nx">find</span><span class="p">(</span><span class="s">&#39;tbody tr&#39;</span><span class="p">).</span><span class="nx">live</span> <span class="s">&#39;click&#39;</span><span class="p">,</span> <span class="nf">() -&gt;</span>
    <span class="nx">$</span><span class="p">(</span><span class="s">&#39;#m_statistics tr&#39;</span><span class="p">).</span><span class="nx">removeAttr</span><span class="p">(</span><span class="s">&#39;class&#39;</span><span class="p">)</span>
    <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s">&quot;class&quot;</span><span class="p">,</span><span class="s">&quot;active&quot;</span><span class="p">)</span>
    <span class="nv">select_index = </span><span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">index</span><span class="p">()</span>
    <span class="nv">name = </span><span class="nx">$</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">find</span><span class="p">(</span><span class="s">&#39;td&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]).</span><span class="nx">html</span><span class="p">()</span>
    <span class="nx">render_slave</span> <span class="nx">name</span>
    <span class="nx">$</span><span class="p">(</span><span class="s">&#39;#queque_detail&#39;</span><span class="p">).</span><span class="nx">show</span><span class="p">()</span>

  <span class="k">for</span> <span class="nx">command</span> <span class="k">in</span> <span class="p">[</span><span class="s">&#39;reschedule&#39;</span><span class="p">,</span> <span class="s">&#39;clear&#39;</span><span class="p">]</span>
    <span class="nx">do</span> <span class="nf">(command) -&gt;</span>
      <span class="nx">$</span><span class="p">(</span><span class="s">&quot;</span><span class="err">#</span><span class="s">m_statistics .btn_</span><span class="si">#{</span><span class="nx">command</span><span class="si">}</span><span class="s">&quot;</span><span class="p">).</span><span class="nx">live</span> <span class="s">&#39;click&#39;</span><span class="p">,</span> <span class="nf">(event)-&gt;</span> 
        <span class="nx">event</span><span class="p">.</span><span class="nx">stopPropagation</span><span class="p">()</span>  
        <span class="nv">name = </span><span class="nx">$</span><span class="p">(</span><span class="nx">@</span><span class="p">).</span><span class="nx">parent</span><span class="p">().</span><span class="nx">parent</span><span class="p">().</span><span class="nx">find</span><span class="p">(</span><span class="s">&#39;td:first&#39;</span><span class="p">).</span><span class="nx">html</span><span class="p">()</span>
        <span class="nv">that = </span><span class="nx">@</span>
        <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
          <span class="nv">type: </span><span class="s">&#39;POST&#39;</span>
          <span class="nv">url: </span><span class="s">&#39;/api/queues/&#39;</span> <span class="o">+</span> <span class="nx">name</span> <span class="o">+</span> <span class="s">&quot;/</span><span class="si">#{</span><span class="nx">command</span><span class="si">}</span><span class="s">&quot;</span>
          <span class="nv">success: </span><span class="nf">(result) -&gt;</span>
            <span class="nx">$</span><span class="p">(</span><span class="nx">that</span><span class="p">).</span><span class="nx">parent</span><span class="p">().</span><span class="nx">parent</span><span class="p">().</span><span class="nx">html</span> <span class="nx">_</span><span class="p">.</span><span class="nx">template</span><span class="p">(</span><span class="nx">statistics_template</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="p">{</span> <span class="nv">item: </span><span class="nx">result</span> <span class="p">})</span>
            <span class="nv">index = </span><span class="nx">$</span><span class="p">(</span><span class="nx">that</span><span class="p">).</span><span class="nx">parent</span><span class="p">().</span><span class="nx">parent</span><span class="p">().</span><span class="nx">index</span><span class="p">()</span>
            <span class="nx">statistics</span><span class="p">[</span><span class="nx">index</span><span class="p">]</span> <span class="o">=</span> <span class="nx">result</span>
            <span class="nx">$</span><span class="p">(</span><span class="s">&#39;#m_statistics tr:last&#39;</span><span class="p">).</span><span class="nx">html</span> <span class="nx">_</span><span class="p">.</span><span class="nx">template</span><span class="p">(</span><span class="nx">statistics_template</span><span class="p">[</span><span class="mi">11</span><span class="p">],</span> <span class="p">{</span> <span class="nv">data: </span><span class="nx">statistics</span> <span class="p">})</span>
        <span class="p">})</span></pre></div></td></tr>   <tr id="section-10"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-10">&#182;</a></div><p>下拉列表改变事件</p></td><td class="code"><div class="highlight"><pre><span class="nx">$</span><span class="p">(</span><span class="s">&quot;select&quot;</span><span class="p">).</span><span class="nx">change</span> <span class="nf">() -&gt;</span>
  <span class="nv">interval = </span><span class="nx">$</span><span class="p">(</span><span class="nx">@</span><span class="p">).</span><span class="nx">val</span><span class="p">()</span></pre></div></td></tr>   <tr id="section-11"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-11">&#182;</a></div><p>点击图标切换 统计 下显示表格的方式</p></td><td class="code"><div class="highlight"><pre><span class="nx">$</span><span class="p">(</span><span class="s">&#39;.icon-th&#39;</span><span class="p">).</span><span class="nx">click</span> <span class="nf">() -&gt;</span>
  <span class="nx">$</span><span class="p">(</span><span class="s">&#39;#workers + .tabbable&#39;</span><span class="p">).</span><span class="nx">addClass</span><span class="p">(</span><span class="s">&#39;xz&#39;</span><span class="p">)</span>
  <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">addClass</span><span class="p">(</span><span class="s">&#39;active&#39;</span><span class="p">)</span>
  <span class="nx">$</span><span class="p">(</span><span class="s">&#39;.icon-th-large&#39;</span><span class="p">).</span><span class="nx">removeClass</span><span class="p">(</span><span class="s">&#39;active&#39;</span><span class="p">)</span>

<span class="nx">$</span><span class="p">(</span><span class="s">&#39;.icon-th-large&#39;</span><span class="p">).</span><span class="nx">click</span> <span class="nf">() -&gt;</span>
  <span class="nx">$</span><span class="p">(</span><span class="s">&#39;#workers + .tabbable&#39;</span><span class="p">).</span><span class="nx">removeClass</span><span class="p">(</span><span class="s">&#39;xz&#39;</span><span class="p">)</span>
  <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">addClass</span><span class="p">(</span><span class="s">&#39;active&#39;</span><span class="p">)</span>
  <span class="nx">$</span><span class="p">(</span><span class="s">&#39;.icon-th&#39;</span><span class="p">).</span><span class="nx">removeClass</span><span class="p">(</span><span class="s">&#39;active&#39;</span><span class="p">)</span></pre></div></td></tr>   <tr id="section-12"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-12">&#182;</a></div><p>顶部阴影</p></td><td class="code"><div class="highlight"><pre><span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">scroll</span> <span class="nf">() -&gt;</span>
  <span class="nv">scroll_top = </span><span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">scrollTop</span><span class="p">()</span>
  <span class="k">if</span> <span class="nx">scroll_top</span> <span class="o">&gt;</span> <span class="mi">40</span>
    <span class="nx">$</span><span class="p">(</span><span class="s">&#39;h1&#39;</span><span class="p">).</span><span class="nx">addClass</span><span class="p">(</span><span class="s">&quot;h1_shadow&quot;</span><span class="p">)</span>
  <span class="k">else</span>
    <span class="nx">$</span><span class="p">(</span><span class="s">&#39;h1&#39;</span><span class="p">).</span><span class="nx">removeClass</span><span class="p">(</span><span class="s">&quot;h1_shadow&quot;</span><span class="p">)</span></pre></div></td></tr>   <tr id="section-13"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-13">&#182;</a></div><p>转化毫秒形式</p></td><td class="code"><div class="highlight"><pre><span class="vi">@parse_milliseconds = </span><span class="nf">(milli) -&gt;</span>
  <span class="nv">second = </span><span class="nx">milli</span><span class="o">/</span><span class="mi">1000</span>
  <span class="k">return</span> <span class="nx">milli</span><span class="o">+</span><span class="s">&#39;ms&#39;</span> <span class="k">if</span> <span class="nx">second</span> <span class="o">&lt;</span> <span class="mi">1</span>
  <span class="k">return</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nx">second</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;s&#39;</span> <span class="k">if</span><span class="p">(</span><span class="mi">1</span><span class="o">&lt;</span><span class="nx">second</span><span class="o">&lt;</span><span class="mi">60</span><span class="p">)</span>
  <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nx">second</span><span class="o">/</span><span class="mi">60</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;m&#39;</span><span class="o">+</span><span class="s">&#39;:&#39;</span><span class="o">+</span><span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nx">second</span><span class="o">%</span><span class="mi">60</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;s&#39;</span> <span class="k">if</span> <span class="nx">second</span> <span class="o">&gt;</span> <span class="mi">60</span></pre></div></td></tr>   <tr id="section-14"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-14">&#182;</a></div><p>提供页面产生唯一编号</p></td><td class="code"><div class="highlight"><pre><span class="vi">@id_factory = </span><span class="nf">() -&gt;</span>
  <span class="nv">i = </span><span class="mi">0</span>
  <span class="k">return</span> <span class="p">{</span><span class="k">new</span><span class="o">:</span> <span class="nf">() -&gt;</span> <span class="k">return</span> <span class="nx">i</span><span class="o">++</span> <span class="p">}</span>

</pre></div></td></tr>  </tbody> </table> </div>  </body> </html> 